---
title: "Dutch Book proof"
output:
 html_document:
  theme: readable
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(matlib)
```

##  An incoherent (Dutch Book) series of bets:
Suppose we are asked to assign probabilities for $3$, mutually exclusive events. Let $E_{1}$, $E_{2}$, $E_{3}$ be the disjoint events and $p_{1}$, $p_{2}$, and $p_3$ the probabilities we associate with each. Simply, $p_{i}$ is the probability of the event $E_{i}$ occurring. We assign the following probabilities to each corresponding event:
```{r, echo = TRUE}
p1 <- .3
p2 <- .1
p3 <- .4
```

We can then construct our probabilities in an $n\times n$ matrix denoted $R$. Note that by constructing the matrix in this way we can account for the positive gain for the outcome of each event $E_{i}$ as well as its complements $E_{i}^{c}$.
```{r, echo = TRUE}
R <- matrix(c(1 - p1,   - p2,   - p3,
                - p1, 1 - p2,   - p3,
                - p1,   - p2, 1 - p3), 
            nrow = 3)
R
```
Given this feature, we can assume that the person betting would take advantage of this information and thus place a stake $s_{n}$ on all of the possible bets $p_{i}$ to maximise the probability of their gain $G$. Subsequently, we apply some arbitrary numerical stake $s_{n}$ to each possible event $p_{i}$,
```{r, echo = TRUE}
s <- c(5, 2, 7)
s
```
and we can then have a matrix $R$ of probabilities assigned to a vector of $s_{n}$ possible stakes. The net gains $\sum_{1}^{n} G_{n}$ can be thus be defined as a product of the matrix $R$ of probabilities and a corresponding vector of stakes $s$. This allows us to solve for the system of linear equations. This provides a corresponding gain $G$, the product of $Rs$, such that $G = Rs$.
```{r, echo = TRUE}
G <- solve(a = R, b = s)
G
```
Note that our net gain $G$ is equal to
```{r, echo = TRUE}
round(sum(G))
```
However, this is an incredibly odd set of circumstances. Something is clearly amiss.

We have managed to obtain a net positive gain $G$ despite placing a stake on all possible bets. It can actually be shown that no matter the outcome, nor the size of the bet, we will _always_ have a positive net gain value. Yet, this is obviously not a result of clairvoyance. Rather, this is due to the fact that our initial probability judgements of the $3$ disjoint events $E_{i}$ were _incoherent_ with respect to Kolmogorovâ€™s probability axiom $P(A\cap, ...,\cap A) = 1$. Critically, the set of probabilities that we assigned to each event $E_{i}$ do not sum to $1$,
```{r, echo = TRUE}
sum(p1 + p2 + p3)
```
This implies that our $n\times n$ matrix $R$ is invertible,
```{r, echo = TRUE}
inv(R)
```
Consequently, an $n\times n$ identity matrix $I$ can be formed from the multiplication of the $n\times n$ matrix $R$ with its inverse $R^{-1}$.

Note that, for those unaware, an identity matrix is a matrix where all the diagonals of a matrix are $1$'s, and the rest of the elements contain only $0$'s. It is, broadly speaking, a convenient tool used for matrix manipulations. Below is a clear example of what a standard $n\times n$ identity matrix $I$ looks like:
```{r, echo = FALSE}
I <- diag(c(1, 1, 1))
I
```
and can be shown to be a literal 'do nothing' matrix, for example, by solving the following,
```{r, echo = TRUE}
I%*%s
```
as the multiplication does not change the values of $s$, such that $I\times s = s$.

Nevertheless, let us confirm whether our matrix $R$ conforms to these conditions, where $I = R^{-1}R$.
```{r, echo = TRUE}
round(inv(R)%*%R)
```
The result of applying $R^{-1}R$ clearly mirrors the standard identity matrix example given above. Nevertheless, this can intuitively can be thought of as a soft proof for whether a system of linear equations is solvable if, for example, $R$ is brought to the other side of the equation, i.e. to see whether we can solve for $s$. 

Regardless, and to return to the focus of this section, it is crucial to note that when the series of event probabilities are incoherent, and thus do indeed lead to an invertible matrix, it suggests that we solve for an unknown set of stakes $s_{n}$ by structuring our bets in such a way that always obtains a positive net gain $G_{n}$, regardless of the outcome. First, we provide the following arbitrary definite gains $G_{n}$ for each stake $s_{n}$,
```{r, echo = TRUE}
G <- c(3, 1, 4)
G
```
It is now possible to solve for the linear transformation of $s_{n}$, by multiplying each side of the equation by $R^{-1}$, so that $R^{-1}Rs=R^{-1}G$, and thus $I\times s = s =R^{-1}G$, which ultimately results in $s = R^{-1}G$:
```{r, echo = TRUE}
s_solved <- solve(a = inv(R), b = G)
s_solved
```
This specific set of conditions, therefore, clearly enable for the placement of a set of stakes $s_{n}$ in such a way that guarantees a positive gain, no matter the future outcome.

Intuitively speaking, we can further understand this proof in a geometric sense: the total 'area' of our set of disjoint probabilities fails to induce a single, whole sample space, where $P(A\cap, ...,\cap A) \neq 1$. Thus, this means that the rows and columns of our matrix are not dependent and, as a corollary, the determinant of the matrix $R$ is $|{R}| > 0$, as evidence by
```{r, echo = TRUE}
det(R)
```
Accordingly, our net gain $\sum_{1}^{n}G_{i}$ is a constant net positive. It is interesting to note that the average person is often on the receiving end of such a betting structure, as it is commonly used by sports bookkeepers and casinos to ensure a net gain regardless of their losses. 

## A coherent series of bets:
It is evident that we are obliged to constrain the total sum of our independent probabilities to be $= 1$. In contrast to the previous example then, we will now assign probability judgements that conform to Kolmogorov's axiom $P(A\cap, ...,\cap A) = 1$.
```{r A coherent bet, echo = TRUE}
p1 <- .3
p2 <- .3
p3 <- .4
```
Note that the sum of probabilities $p_{i}$ now equals to $1$.
```{r}
sum(p1 + p2 + p3)
```

Again, we can conveniently place these probabilistic events in the form of an $n\times n$ matrix $R$ in order to present all possible, joint negative betting outcomes, while simultaneously representing a single realised, positive disjoint event:
```{r, echo = TRUE}
R <- matrix(c(1 - p1,   - p2,   - p3,
                - p1, 1 - p2,   - p3,
                - p1,   - p2, 1 - p3), 
            nrow = 3)
R
```
However, because we have ensured that $P(A\cap, ...,\cap A) = 1$, where all disjoint events sum to $1$, the matrix $R$ is not invertible. An identity matrix $I$ cannot, therefore, be computed, as $I \ne R^{-1}R$.

Moreover, now that the sum of probabilities is clearly coherent, it will always result in a net gain of $0$ for any arbitrary vector set of stakes $s_{n$. To illustrate this, we randomly sample $3$ stake values between $1:10000$,
```{r, echo = TRUE}
s <- sample(x = 1:10000, size = 3, replace = TRUE)
s
```
showing the gains for each bet equal,
```{r, echo = TRUE}
G <- R%*%s
G
```
and that, despite the relatively high stakes on each bet compared to the previous examples, the net overall gain $G$ maintains to be a constant $0$:
```{r, echo = TRUE}
round(sum(G))
```